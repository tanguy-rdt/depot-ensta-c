<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>TP4 - Threads POSIX</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="styling.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">TP4 - Threads POSIX</h1>
<p class="date">04 octobre 2022</p>
</header>
<h1 id="table-des-matières">Table des matières</h1>
<ul>
<li><a href="#table-des-matières">Table des matières</a></li>
<li><a href="#fonctions">Fonctions</a></li>
<li><a href="#exemple">Exemple</a></li>
<li><a href="#code-du-tp">Code du TP</a></li>
</ul>
<h1 id="fonctions">Fonctions</h1>
<h2 id="création-dun-thread">Création d’un thread</h2>
<ol type="1">
<li><p><code>pthread_create()</code></p>
<p>Permet la création d’un thread.<br />
Le prototype
<code>int pthread_create(pthread_t * thread, pthread_attr_t * attr, void * (*start_routine)(void *), void * arg)</code>,
prends comme argument :</p>
<ul>
<li><em>arg1</em>: Une variable de type <code>pthread_t myTh</code>,
c’est en quelque sorte un lien avec le thread, l’identifiant du thread
créé est dans cette variable.</li>
<li><em>arg2</em>: Objet attribut comme une politique d’ordonnancement,
par exemple. <code>NULL</code>, si rien à donner</li>
<li><em>arg3</em>: Une fonction que le thread doit réaliser</li>
<li><em>arg4</em>: L’argument pris par la fonction que le thread doit
réaliser, donné à l’arg3</li>
</ul>
<p>La fonction retourne 0 pour un succès sinon -1</p></li>
</ol>
<h2 id="les-mutex">Les mutex</h2>
<ol type="1">
<li><p><code>pthread_mutex_init()</code></p>
<p>Permet d’initialiser un mutex.<br />
Le prototype
<code>int pthread_mutex_init(pthread_mutex_t *mutex, pthread_mutexattr_t *attr)</code>,
prends comme argument :</p>
<ul>
<li><em>arg1</em>: Une variable de type
<code>pthread_mutex_t* myMutex</code>, c’est en quelque sorte un lien
avec le mutex, l’identifiant du mutex créé est dans cette variable.</li>
<li><em>arg2</em>: Un attribut, dans le cas où <em>arg2</em> est
<code>NULL</code> alors c’est l’attribut <code>NONRECURSIVE</code> qui
est utilisé.</li>
</ul>
<p>La fonction retourne 0 pour un succès sinon -1</p></li>
<li><p><code>pthread_mutex_lock()</code></p>
<p>Permet de verrouiller un mutex.<br />
Le prototype
<code>int pthread_mutex_lock(pthread_mutex_t *mutex)</code>, prends
comme argument :</p>
<ul>
<li><em>arg1</em>: Le mutex à verrouiller, précédemment initialiser
avant avec <code>pthread_mutex_init()</code></li>
</ul>
<p>La fonction retourne 0 pour un succès sinon -1</p></li>
<li><p><code>pthread_mutex_unlock()</code></p>
<p>Permet de libérer un mutex.<br />
Le prototype
<code>int pthread_mutex_unlock(pthread_mutex_t *mutex)</code>, prends
comme argument :</p>
<ul>
<li><em>arg1</em>: Le mutex à déverrouiller, précédemment verrouiller
avant avec <code>pthread_mutex_lock()</code></li>
</ul>
<p>La fonction retourne 0 pour un succès sinon -1</p></li>
<li><p><code>pthread_mutex_destroy()</code></p>
<p>Permet de détruire un mutex.<br />
Le prototype
<code>int pthread_mutex_destroy(pthread_mutex_t *mutex);</code>, prends
comme argument :</p>
<ul>
<li><em>arg1</em>: Le mutex à détruire.</li>
</ul>
<p>La fonction retourne 0 pour un succès sinon -1</p></li>
</ol>
<h2 id="les-conditions">Les conditions</h2>
<ol type="1">
<li><p><code>pthread_cond_init()</code></p>
<p>Permet d’initialiser une condition.<br />
Le prototype
<code>int pthread_cond_init(pthread_cond_t *cond, pthread_condattr_t *attr)</code>,
prends comme argument :</p>
<ul>
<li><em>arg1</em>: Une variable de type
<code>pthread_cond_t* myCond</code>, c’est la variable à utiliser à
chaque fois que l’on veut intéragir avec la condition.</li>
<li><em>arg2</em>: Objet attribut. <code>NULL</code>, si rien à
donner</li>
</ul>
<p>La fonction retourne 0 pour un succès sinon -1</p></li>
<li><p><code>pthread_cond_wait()</code></p>
<p>Permet d’attendre qu’une condition soit effectuée.<br />
Le prototype
<code>int pthread_cond_wait(pthread_cond_t *cond, pthread_mutex_t *mutex)</code>,
prends comme argument :</p>
<ul>
<li><em>arg1</em>: La variable condition, utilisée lors de
l’initialisation avec <code>pthread_cond_init()</code>.</li>
<li><em>arg2</em>: Un mutex pour l’associer à la condition.</li>
</ul>
<p>La fonction retourne 0 pour un succès sinon -1</p>
<p>À l’appel de cette fonction, il est nécessaire de verrouillé le mutex
associé <em>(voir <code>pthread_mutex_lock()</code>)</em> avant et de le
libérer après <em>(voir
<code>pthread_mutex_unlock()</code>)</em>.</p></li>
<li><p><code>pthread_cond_broadcast()</code></p>
<p>Permet d’envoyer un signal à toutes les conditions qui attendent,
pour dire que la condition est remplie.<br />
Le prototype
<code>int pthread_cond_broadcast(pthread_cond_t *cond)</code>, prends
comme argument :</p>
<ul>
<li><em>arg1</em>: La condition qui a été remplie, donc il faut envoyer
un signal au thread attendant cette condition.</li>
</ul>
<p>La fonction retourne 0 pour un succès sinon -1</p>
<p>À l’appel de cette fonction, il est nécessaire de verrouillé le mutex
associé <em>(voir <code>pthread_mutex_lock()</code>)</em> avant et de le
libérer après <em>(voir
<code>pthread_mutex_unlock()</code>)</em>.</p></li>
<li><p><code>pthread_cond_destroy()</code></p>
<p>Permet de détruire une condition.<br />
Le prototype
<code>int pthread_cond_destroy(pthread_cond_t *cond)</code>, prend comme
argument :</p>
<ul>
<li><em>arg1</em>: La condition à détruire.</li>
</ul>
<p>La fonction retourne 0 pour un succès sinon -1</p></li>
</ol>
<h2 id="attendre-la-fin-dun-thread">Attendre la fin d’un thread</h2>
<p><code>pthread_join()</code>, permet d’attendre la fin de l’exécution
d’un thread.<br />
Le prototype
<code>int pthread_join(pthread_t thread, void **status)</code>, prends
comme argument :</p>
<ul>
<li><em>arg1</em>: Le thread à attendre.</li>
<li><em>arg2</em>: Contient la valeur de retour du thread renvoyer par
<code>pthread_exit()</code>, <code>return</code>, ou -1 dans le cas
d’une annulation.</li>
</ul>
<p>La fonction retourne 0 pour un succès sinon -1</p>
<h1 id="exemple">Exemple</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>pthread_mutex_t mutex<span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>pthread_cond_t cond<span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> halfThread1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>thread2<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// wait the half of the thread1 (5sec)</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_lock<span class="op">(&amp;</span>mutex<span class="op">);</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span><span class="op">(!</span>halfThread1<span class="op">){</span> pthread_cond_wait<span class="op">(&amp;</span>cond<span class="op">,</span> <span class="op">&amp;</span>mutex<span class="op">);}</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_unlock<span class="op">(&amp;</span>mutex<span class="op">);</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// start the prog of the thread2</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;start thread2 </span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    sleep<span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;end thread2 </span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>thread1<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">// start the prog of the thread 1</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;start thread1 </span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    sleep<span class="op">(</span><span class="dv">5</span><span class="op">);</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// half of the thread1 --&gt; start thread2</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;half of the thread1 </span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    halfThread1 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_lock<span class="op">(&amp;</span>mutex<span class="op">);</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    pthread_cond_broadcast<span class="op">(&amp;</span>cond<span class="op">);</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_unlock<span class="op">(&amp;</span>mutex<span class="op">);</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    sleep<span class="op">(</span><span class="dv">5</span><span class="op">);</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;end thread1 </span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main <span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;------------------- Start -------------------</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    pthread_t thr1<span class="op">,</span> thr2<span class="op">;</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span><span class="op">*</span> retThread1<span class="op">;</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span><span class="op">*</span> retThread2<span class="op">;</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">// init the mutex and cond</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_init<span class="op">(&amp;</span>mutex<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    pthread_cond_init<span class="op">(&amp;</span>cond<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    <span class="co">// create the thread</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">((</span>pthread_create<span class="op">(&amp;</span>thr1<span class="op">,</span> NULL<span class="op">,</span> thread1<span class="op">,</span> NULL<span class="op">))</span> <span class="op">||</span> <span class="op">(</span>pthread_create<span class="op">(&amp;</span>thr2<span class="op">,</span> NULL<span class="op">,</span> thread2<span class="op">,</span> NULL<span class="op">))!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;Error during pthread_create()</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    <span class="co">// wait the end of the thread, return the exit value in arg2</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    pthread_join<span class="op">(</span>thr1<span class="op">,</span> <span class="op">&amp;</span>retThread1<span class="op">);</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    pthread_join<span class="op">(</span>thr2<span class="op">,</span> <span class="op">&amp;</span>retThread2<span class="op">);</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="co">// destroy the mutex and cond</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_destroy<span class="op">(&amp;</span>mutex<span class="op">);</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    pthread_cond_destroy<span class="op">(&amp;</span>cond<span class="op">);</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;return value of the thread1: %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> retThread1<span class="op">);</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;return value of the thread2: %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> retThread2<span class="op">);</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;-------------------- End --------------------&quot;</span><span class="op">);</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<blockquote>
<p>——————- Start ——————-<br />
start thread1<br />
half of the thread1<br />
start thread2<br />
end thread1<br />
end thread2<br />
return value of the thread1: 1<br />
return value of the thread2: 2<br />
——————– End ——————–</p>
</blockquote>
<h1 id="code-du-tp">Code du TP</h1>
<p><em>cf.</em> <a
href="https://git.roudaut.xyz/ensta/depot-ensta-c/-/blob/SA3/OS/TP4"><em>TP4</em></a></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/time.h&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/wait.h&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">/*********** Data Type ***********/</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">enum</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>STATE_WAIT<span class="op">,</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>STATE_MULT<span class="op">,</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>STATE_ADD<span class="op">,</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>STATE_PRINT</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> State<span class="op">;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>State state<span class="op">;</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span> pendingMult<span class="op">;</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>pthread_cond_t cond<span class="op">;</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>pthread_mutex_t mutex<span class="op">;</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="dt">size_t</span> nbIterations<span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="dt">size_t</span> size<span class="op">;</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> <span class="op">*</span> v1<span class="op">;</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> <span class="op">*</span> v2<span class="op">;</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> <span class="op">*</span> v3<span class="op">;</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> result<span class="op">;</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Product<span class="op">;</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co">/*********** Data structure ***********/</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>Product prod<span class="op">;</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="co">/*********** Function ***********/</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> initPendingMult<span class="op">(</span>Product<span class="op">*</span> prod<span class="op">){</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> i<span class="op">;</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>prod<span class="op">-&gt;</span>size<span class="op">;</span>i<span class="op">++){</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>        prod<span class="op">-&gt;</span>pendingMult<span class="op">[</span>i<span class="op">]=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> nbPendingMult<span class="op">(</span>Product<span class="op">*</span> prod<span class="op">){</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> i<span class="op">;</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> nb<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>prod<span class="op">-&gt;</span>size<span class="op">;</span>i<span class="op">++){</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>        nb<span class="op">+=</span>prod<span class="op">-&gt;</span>pendingMult<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">(</span>nb<span class="op">);</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> wasteTime<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">long</span> ms<span class="op">){</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> t<span class="op">,</span>t0<span class="op">;</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> timeval tv<span class="op">;</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    gettimeofday<span class="op">(&amp;</span>tv<span class="op">,(</span><span class="kw">struct</span> timezone <span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    t0<span class="op">=</span>tv<span class="op">.</span>tv_sec<span class="op">*</span><span class="dv">1000</span><span class="bu">LU</span><span class="op">+</span>tv<span class="op">.</span>tv_usec<span class="op">/</span><span class="dv">1000</span><span class="bu">LU</span><span class="op">;</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">do</span><span class="op">{</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>        gettimeofday<span class="op">(&amp;</span>tv<span class="op">,(</span><span class="kw">struct</span> timezone <span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>        t<span class="op">=</span>tv<span class="op">.</span>tv_sec<span class="op">*</span><span class="dv">1000</span><span class="bu">LU</span><span class="op">+</span>tv<span class="op">.</span>tv_usec<span class="op">/</span><span class="dv">1000</span><span class="bu">LU</span><span class="op">;</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">while</span><span class="op">(</span>t<span class="op">-</span>t0<span class="op">&lt;</span>ms<span class="op">);</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>mult<span class="op">(</span><span class="dt">void</span> <span class="op">*</span> data<span class="op">){</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> index<span class="op">;</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> iter<span class="op">;</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span><span class="al">TODO</span><span class="co">: Recuperation de l&#39;index, c&#39;est a dire index = ...</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    index <span class="op">=</span> <span class="op">(</span><span class="dt">size_t</span><span class="op">)</span>data<span class="op">;</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stderr<span class="op">,</span><span class="st">&quot;Begin mult(%d)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span>index<span class="op">);</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>iter<span class="op">=</span><span class="dv">0</span><span class="op">;</span>iter<span class="op">&lt;</span>prod<span class="op">.</span>nbIterations<span class="op">;</span>iter<span class="op">++){</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>        <span class="co">//</span><span class="al">TODO</span><span class="co">: Attendre l&#39;autorisation de multiplication POUR UNE NOUVELLE ITERATION...</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_lock<span class="op">(&amp;</span>prod<span class="op">.</span>mutex<span class="op">);</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span><span class="op">((</span>prod<span class="op">.</span>state <span class="op">!=</span> STATE_MULT<span class="op">)</span> <span class="op">||</span> <span class="op">(</span>nbPendingMult<span class="op">(&amp;</span>prod<span class="op">)</span> <span class="op">!=</span> prod<span class="op">.</span>size<span class="op">)){</span>pthread_cond_wait<span class="op">(&amp;</span>prod<span class="op">.</span>cond<span class="op">,</span> <span class="op">&amp;</span>prod<span class="op">.</span>mutex<span class="op">);}</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_unlock<span class="op">(&amp;</span>prod<span class="op">.</span>mutex<span class="op">);</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span><span class="st">&quot;--&gt; mult(%d)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span>index<span class="op">);</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>        <span class="co">//</span><span class="al">TODO</span><span class="co">: Effectuer la multiplication a l&#39;index du thread courant...</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>        prod<span class="op">.</span>v3<span class="op">[</span>index<span class="op">]</span> <span class="op">=</span> prod<span class="op">.</span>v1<span class="op">[</span>index<span class="op">]</span> <span class="op">*</span> prod<span class="op">.</span>v2<span class="op">[</span>index<span class="op">];</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>        wasteTime<span class="op">(</span><span class="dv">200</span><span class="op">+(</span>rand<span class="op">()%</span><span class="dv">200</span><span class="op">));</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span><span class="st">&quot;&lt;-- mult(%d) : %.3g*%.3g=%.3g</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> index<span class="op">,</span>prod<span class="op">.</span>v1<span class="op">[</span>index<span class="op">],</span>prod<span class="op">.</span>v2<span class="op">[</span>index<span class="op">],</span>prod<span class="op">.</span>v3<span class="op">[</span>index<span class="op">]);</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>        <span class="co">//</span><span class="al">TODO</span><span class="co">: Marquer la fin de la multiplication en cours...</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_lock<span class="op">(&amp;</span>prod<span class="op">.</span>mutex<span class="op">);</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>        prod<span class="op">.</span>pendingMult<span class="op">[</span>index<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_unlock<span class="op">(&amp;</span>prod<span class="op">.</span>mutex<span class="op">);</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>        <span class="co">//</span><span class="al">TODO</span><span class="co">: Si c&#39;est la derniere...</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>nbPendingMult<span class="op">(&amp;</span>prod<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">){</span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>            <span class="co">//</span><span class="al">TODO</span><span class="co">: Autoriser le demarrage de l&#39;addition...</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>            pthread_mutex_lock<span class="op">(&amp;</span>prod<span class="op">.</span>mutex<span class="op">);</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>            prod<span class="op">.</span>state <span class="op">=</span> STATE_ADD<span class="op">;</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>            pthread_cond_broadcast<span class="op">(&amp;</span>prod<span class="op">.</span>cond<span class="op">);</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>            pthread_mutex_unlock<span class="op">(&amp;</span>prod<span class="op">.</span>mutex<span class="op">);</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stderr<span class="op">,</span><span class="st">&quot;Quit mult(%d)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span>index<span class="op">);</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">(</span>data<span class="op">);</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span> add<span class="op">(</span><span class="dt">void</span> <span class="op">*</span> data<span class="op">){</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> iter<span class="op">;</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stderr<span class="op">,</span><span class="st">&quot;Begin add()</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>iter<span class="op">=</span><span class="dv">0</span><span class="op">;</span>iter<span class="op">&lt;</span>prod<span class="op">.</span>nbIterations<span class="op">;</span>iter<span class="op">++){</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> index<span class="op">;</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>        <span class="co">//</span><span class="al">TODO</span><span class="co">: Attendre l&#39;autorisation d&#39;addition...</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_lock<span class="op">(&amp;</span>prod<span class="op">.</span>mutex<span class="op">);</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span><span class="op">(</span>prod<span class="op">.</span>state <span class="op">!=</span> STATE_ADD<span class="op">){</span>pthread_cond_wait<span class="op">(&amp;</span>prod<span class="op">.</span>cond<span class="op">,</span> <span class="op">&amp;</span>prod<span class="op">.</span>mutex<span class="op">);}</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_unlock<span class="op">(&amp;</span>prod<span class="op">.</span>mutex<span class="op">);</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span><span class="st">&quot;--&gt; add</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>        prod<span class="op">.</span>result<span class="op">=</span><span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span>index<span class="op">=</span><span class="dv">0</span><span class="op">;</span>index<span class="op">&lt;</span>prod<span class="op">.</span>size<span class="op">;</span>index<span class="op">++){</span></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>            <span class="co">//</span><span class="al">TODO</span><span class="co">: Effectuer l&#39;addition...</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>            prod<span class="op">.</span>result <span class="op">+=</span> prod<span class="op">.</span>v3<span class="op">[</span>index<span class="op">];</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>        wasteTime<span class="op">(</span><span class="dv">100</span><span class="op">+(</span>rand<span class="op">()%</span><span class="dv">100</span><span class="op">));</span></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span><span class="st">&quot;&lt;-- add</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>        <span class="co">//</span><span class="al">TODO</span><span class="co">: Autoriser le demarrage de l&#39;affichage...</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_lock<span class="op">(&amp;</span>prod<span class="op">.</span>mutex<span class="op">);</span></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>        prod<span class="op">.</span>state <span class="op">=</span> STATE_PRINT<span class="op">;</span></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>        pthread_cond_broadcast<span class="op">(&amp;</span>prod<span class="op">.</span>cond<span class="op">);</span></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_unlock<span class="op">(&amp;</span>prod<span class="op">.</span>mutex<span class="op">);</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stderr<span class="op">,</span><span class="st">&quot;Quit add()</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">(</span>data<span class="op">);</span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a><span class="co">/*********** Main ***********/</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span><span class="dt">char</span> <span class="op">**</span> argv<span class="op">)</span></span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> i<span class="op">,</span> iter<span class="op">;</span></span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>    pthread_t <span class="op">*</span>multTh<span class="op">;</span></span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span>    <span class="op">*</span>multData<span class="op">;</span></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>    pthread_t  addTh<span class="op">;</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span>      <span class="op">*</span>threadReturnValue<span class="op">;</span></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span><span class="dt">void</span><span class="op">)</span>addTh<span class="op">;</span> <span class="op">(</span><span class="dt">void</span><span class="op">)</span>threadReturnValue<span class="op">;</span></span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Lire le nombre d&#39;iterations et la taille des vecteurs */</span></span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">((</span>argc<span class="op">&lt;=</span><span class="dv">2</span><span class="op">)||</span></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>sscanf<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span><span class="st">&quot;%u&quot;</span><span class="op">,&amp;</span>prod<span class="op">.</span>nbIterations<span class="op">)!=</span><span class="dv">1</span><span class="op">)||</span></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>sscanf<span class="op">(</span>argv<span class="op">[</span><span class="dv">2</span><span class="op">],</span><span class="st">&quot;%u&quot;</span><span class="op">,&amp;</span>prod<span class="op">.</span>size<span class="op">)!=</span><span class="dv">1</span><span class="op">)||</span></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>    <span class="op">((</span><span class="dt">int</span><span class="op">)</span>prod<span class="op">.</span>nbIterations<span class="op">&lt;=</span><span class="dv">0</span><span class="op">)||((</span><span class="dt">int</span><span class="op">)</span>prod<span class="op">.</span>size<span class="op">&lt;=</span><span class="dv">0</span><span class="op">))</span></span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span><span class="st">&quot;usage: %s nbIterations vectorSize</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Initialisations (Product, tableaux, generateur aleatoire,etc) */</span></span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>    prod<span class="op">.</span>state<span class="op">=</span>STATE_WAIT<span class="op">;</span></span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>    prod<span class="op">.</span>pendingMult<span class="op">=(</span><span class="dt">int</span> <span class="op">*)</span>malloc<span class="op">(</span>prod<span class="op">.</span>size<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span><span class="al">TODO</span><span class="co">: initialiser prod.mutex...</span></span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_init<span class="op">(&amp;</span>prod<span class="op">.</span>mutex<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span><span class="al">TODO</span><span class="co">: initialiser prod.cond...</span></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>    pthread_cond_init<span class="op">(&amp;</span>prod<span class="op">.</span>cond<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Allocation dynamique des 3 vecteurs v1, v2, v3 */</span></span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>    prod<span class="op">.</span>v1<span class="op">=(</span><span class="dt">double</span> <span class="op">*)</span>malloc<span class="op">(</span>prod<span class="op">.</span>size<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">double</span><span class="op">));</span></span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>    prod<span class="op">.</span>v2<span class="op">=(</span><span class="dt">double</span> <span class="op">*)</span>malloc<span class="op">(</span>prod<span class="op">.</span>size<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">double</span><span class="op">));</span></span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>    prod<span class="op">.</span>v3<span class="op">=(</span><span class="dt">double</span> <span class="op">*)</span>malloc<span class="op">(</span>prod<span class="op">.</span>size<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">double</span><span class="op">));</span></span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Allocation dynamique du tableau pour les threads multiplieurs */</span></span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>    multTh<span class="op">=(</span>pthread_t <span class="op">*)</span>malloc<span class="op">(</span>prod<span class="op">.</span>size<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span>pthread_t<span class="op">));</span></span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Allocation dynamique du tableau des MulData */</span></span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>    multData<span class="op">=(</span><span class="dt">size_t</span> <span class="op">*)</span>malloc<span class="op">(</span>prod<span class="op">.</span>size<span class="op">*</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">size_t</span><span class="op">));</span></span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Initialisation du tableau des MulData */</span></span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>prod<span class="op">.</span>size<span class="op">;</span>i<span class="op">++){</span></span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>        multData<span class="op">[</span>i<span class="op">]=</span>i<span class="op">;</span></span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span><span class="al">TODO</span><span class="co">: Creer les threads de multiplication...</span></span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>prod<span class="op">.</span>size<span class="op">;</span> i<span class="op">++){</span></span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>pthread_create<span class="op">(</span>multTh<span class="op">+</span>i<span class="op">,</span> NULL<span class="op">,</span> mult<span class="op">,</span> <span class="op">(</span><span class="dt">size_t</span><span class="op">*)</span>multData<span class="op">[</span>i<span class="op">])</span>  <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>            fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">&quot;Error during pthread_create()</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>            exit<span class="op">(</span>EXIT_FAILURE<span class="op">);</span></span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span><span class="al">TODO</span><span class="co">: Creer le thread d&#39;addition...</span></span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>    pthread_create<span class="op">(&amp;</span>addTh<span class="op">,</span> NULL<span class="op">,</span> add<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>    srand<span class="op">(</span>time<span class="op">((</span><span class="dt">time_t</span> <span class="op">*)</span><span class="dv">0</span><span class="op">));</span>   <span class="co">// Init du generateur de nombres aleatoires</span></span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>iter<span class="op">=</span><span class="dv">0</span><span class="op">;</span>iter<span class="op">&lt;</span>prod<span class="op">.</span>nbIterations<span class="op">;</span>iter<span class="op">++){</span></span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> j<span class="op">;</span></span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Initialiser aleatoirement les deux vecteurs</span></span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span>j<span class="op">=</span><span class="dv">0</span><span class="op">;</span>j<span class="op">&lt;</span>prod<span class="op">.</span>size<span class="op">;</span>j<span class="op">++){</span></span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>            prod<span class="op">.</span>v1<span class="op">[</span>j<span class="op">]=</span><span class="fl">10.0</span><span class="op">*(</span><span class="fl">0.5</span><span class="op">-((</span><span class="dt">double</span><span class="op">)</span>rand<span class="op">())/((</span><span class="dt">double</span><span class="op">)</span>RAND_MAX<span class="op">));</span></span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>            prod<span class="op">.</span>v2<span class="op">[</span>j<span class="op">]=</span><span class="fl">10.0</span><span class="op">*(</span><span class="fl">0.5</span><span class="op">-((</span><span class="dt">double</span><span class="op">)</span>rand<span class="op">())/((</span><span class="dt">double</span><span class="op">)</span>RAND_MAX<span class="op">));</span></span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>        <span class="co">//</span><span class="al">TODO</span><span class="co">: Autoriser le demarrage des multiplications pour une nouvelle iteration...</span></span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a>        initPendingMult<span class="op">(&amp;</span>prod<span class="op">);</span></span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_lock<span class="op">(&amp;</span>prod<span class="op">.</span>mutex<span class="op">);</span></span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a>        prod<span class="op">.</span>state <span class="op">=</span> STATE_MULT<span class="op">;</span></span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a>        pthread_cond_broadcast<span class="op">(&amp;</span>prod<span class="op">.</span>cond<span class="op">);</span></span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_unlock<span class="op">(&amp;</span>prod<span class="op">.</span>mutex<span class="op">);</span></span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a>        <span class="co">//</span><span class="al">TODO</span><span class="co">: Attendre l&#39;autorisation d&#39;affichage...</span></span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_lock<span class="op">(&amp;</span>prod<span class="op">.</span>mutex<span class="op">);</span></span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span><span class="op">(</span>prod<span class="op">.</span>state <span class="op">!=</span> STATE_PRINT<span class="op">){</span>pthread_cond_wait<span class="op">(&amp;</span>prod<span class="op">.</span>cond<span class="op">,</span> <span class="op">&amp;</span>prod<span class="op">.</span>mutex<span class="op">);}</span></span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_unlock<span class="op">(&amp;</span>prod<span class="op">.</span>mutex<span class="op">);</span></span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a>        <span class="co">//</span><span class="al">TODO</span><span class="co">: Afficher le resultat de l&#39;iteration courante...</span></span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a>        fprintf<span class="op">(</span>stderr<span class="op">,</span><span class="st">&quot;ITERATION %d, RESULT=%.4g</span><span class="sc">\n\n</span><span class="st">&quot;</span><span class="op">,</span> iter<span class="op">,</span> prod<span class="op">.</span>result<span class="op">);</span></span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span><span class="al">TODO</span><span class="co">: Attendre la fin des threads de multiplication...</span></span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>prod<span class="op">.</span>size<span class="op">;</span> i<span class="op">++){</span></span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a>        pthread_join<span class="op">(*(</span>multTh<span class="op">+</span>i<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span><span class="al">TODO</span><span class="co">: Attendre la fin du thread d&#39;addition...</span></span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a>    pthread_join<span class="op">(</span>addTh<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span><span class="al">TODO</span><span class="co">: detruire prod.cond ...</span></span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a>    pthread_cond_destroy<span class="op">(&amp;</span>prod<span class="op">.</span>cond<span class="op">);</span></span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span><span class="al">TODO</span><span class="co">: detruire prod.mutex...</span></span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_destroy<span class="op">(&amp;</span>prod<span class="op">.</span>mutex<span class="op">);</span></span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Detruire avec free ce qui a ete initialise avec malloc */</span></span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>prod<span class="op">.</span>pendingMult<span class="op">);</span></span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>prod<span class="op">.</span>v1<span class="op">);</span></span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>prod<span class="op">.</span>v2<span class="op">);</span></span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>prod<span class="op">.</span>v3<span class="op">);</span></span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>multTh<span class="op">);</span></span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>multData<span class="op">);</span></span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">(</span>EXIT_SUCCESS<span class="op">);</span></span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<blockquote>
<p>Begin mult(0)<br />
Begin mult(1)<br />
Begin mult(2)<br />
Begin mult(3)<br />
Begin add()<br />
–&gt; mult(0)<br />
–&gt; mult(1)<br />
–&gt; mult(2)<br />
–&gt; mult(3)<br />
&lt;– mult(2) : 2.65<em>4.85=12.8<br />
&lt;– mult(1) : -3.39</em>-1.31=4.45<br />
&lt;– mult(0) : 2.62<em>3.94=10.3<br />
&lt;– mult(3) : -0.365</em>0.701=-0.256<br />
–&gt; add<br />
&lt;– add<br />
ITERATION 0, RESULT=27.36<br />
<br />
–&gt; mult(3)<br />
–&gt; mult(1)<br />
–&gt; mult(2)<br />
–&gt; mult(0)<br />
&lt;– mult(0) : -2.64<em>1.04=-2.74<br />
&lt;– mult(1) : 4.55</em>1.06=4.84<br />
&lt;– mult(2) : 0.591<em>-1.8=-1.06<br />
&lt;– mult(3) : -4.83</em>3.86=-18.6<br />
–&gt; add<br />
&lt;– add<br />
ITERATION 1, RESULT=-17.6<br />
<br />
–&gt; mult(2)<br />
–&gt; mult(1)<br />
–&gt; mult(3)<br />
–&gt; mult(0)<br />
&lt;– mult(2) : 3.88<em>4.95=19.2<br />
Quit mult(2)<br />
&lt;– mult(0) : 3.95</em>-0.27=-1.07<br />
Quit mult(0)<br />
&lt;– mult(1) : 0.963<em>2.44=2.35<br />
Quit mult(1)<br />
&lt;– mult(3) : 3.33</em>3.97=13.2<br />
Quit mult(3)<br />
–&gt; add<br />
&lt;– add<br />
Quit add()<br />
ITERATION 2, RESULT=33.73</p>
</blockquote>
</body>
</html>
